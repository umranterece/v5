# üìä Performance Dok√ºmantasyonu

> Vue 3 Agora Video Conference Module - Performance optimizasyonlarƒ± ve best practices

## üéØ **Performance Genel Bakƒ±≈ü**

Bu dok√ºmantasyon, projenin performance optimizasyonlarƒ±nƒ±, memory management stratejilerini ve performance monitoring yakla≈üƒ±mlarƒ±nƒ± detaylandƒ±rƒ±r.

## üöÄ **Performance Optimizasyonlarƒ±**

### **1. Bundle Optimization**

#### **Code Splitting**
```javascript
// vite.config.js
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'agora-sdk': ['agora-rtc-sdk-ng'],
          'vue-vendor': ['vue', 'pinia'],
          'utils': ['mitt', 'lodash-es']
        }
      }
    }
  }
})
```

#### **Tree Shaking**
```javascript
// Sadece gerekli fonksiyonlarƒ± import et
import { createSafeTimeout, formatTime } from './utils/index.js'

// T√ºm utils'i import etme
// import * as utils from './utils/index.js'
```

#### **Dynamic Imports**
```javascript
// Lazy loading components
const AgoraConference = () => import('./components/AgoraConference.vue')
const LogModal = () => import('./components/LogModal.vue')
const RecordingControls = () => import('./components/RecordingControls.vue')
```

### **2. Vue Performance Optimizations**

#### **Computed Properties Caching**
```javascript
// ‚úÖ ƒ∞yi: Computed property ile caching
const allUsers = computed(() => {
  const localUsers = []
  if (users.value.local.screen) localUsers.push(users.value.local.screen)
  if (users.value.local.video) localUsers.push(users.value.local.video)
  return [...localUsers, ...users.value.remote]
})

// ‚ùå K√∂t√º: Her render'da hesaplama
const allUsers = () => {
  const localUsers = []
  if (users.value.local.screen) localUsers.push(users.value.local.screen)
  if (users.value.local.video) localUsers.push(users.value.local.video)
  return [...localUsers, ...users.value.remote]
}
```

#### **Reactive References Optimization**
```javascript
// ‚úÖ ƒ∞yi: Shallow ref kullan
const largeObject = shallowRef({ /* b√ºy√ºk obje */ })

// ‚úÖ ƒ∞yi: Readonly ref'ler
const publicState = readonly(computed(() => store.state))

// ‚ùå K√∂t√º: Gereksiz reactive wrapping
const simpleValue = ref(42) // Sadece number i√ßin ref gerekli deƒüil
```

#### **Event Handler Optimization**
```javascript
// ‚úÖ ƒ∞yi: Debounced event handlers
const debouncedSearch = debounce((query) => {
  performSearch(query)
}, 300)

// ‚úÖ ƒ∞yi: Throttled scroll handlers
const throttledScroll = throttle((event) => {
  handleScroll(event)
}, 100)

// ‚ùå K√∂t√º: Her render'da yeni function
<input @input="(e) => handleInput(e.target.value)" />
```

### **3. Memory Management**

#### **Timeout ve Interval Tracking**
```javascript
// ‚úÖ ƒ∞yi: Timeout'larƒ± takip et ve temizle
const activeTimeouts = ref(new Set())
const activeIntervals = ref(new Set())

const createSafeTimeout = (callback, delay) => {
  const timeoutId = setTimeout(() => {
    callback()
    activeTimeouts.value.delete(timeoutId)
  }, delay)
  
  activeTimeouts.value.add(timeoutId)
  return timeoutId
}

// Cleanup
onUnmounted(() => {
  activeTimeouts.value.forEach(clearTimeout)
  activeTimeouts.value.clear()
  activeIntervals.value.forEach(clearInterval)
  activeIntervals.value.clear()
})
```

#### **Event Listener Cleanup**
```javascript
// ‚úÖ ƒ∞yi: Event listener'larƒ± temizle
const cleanupEventListeners = () => {
  if (centralEmitter) {
    centralEmitter.off(AGORA_EVENTS.USER_JOINED, handleUserJoined)
    centralEmitter.off(AGORA_EVENTS.USER_LEFT, handleUserLeft)
  }
}

onUnmounted(() => {
  cleanupEventListeners()
})
```

#### **Track Management**
```javascript
// ‚úÖ ƒ∞yi: Track'leri d√ºzg√ºn temizle
const cleanupTrack = (track) => {
  if (track && track.stop) {
    track.stop()
  }
  if (track && track.close) {
    track.close()
  }
}

// Store cleanup
const cleanupTracks = () => {
  Object.values(localTracks.value).forEach(track => {
    if (track) cleanupTrack(track)
  })
  
  remoteTracks.value.forEach(track => {
    if (track) cleanupTrack(track)
  })
}
```

### **4. Network Performance**

#### **Agora SDK Optimizations**
```javascript
// ‚úÖ ƒ∞yi: Agora config optimizasyonlarƒ±
export const AGORA_CONFIG = {
  mode: 'rtc',
  codec: 'h264', // H264 daha hƒ±zlƒ±
  enableDualStream: false, // Tek stream kullan
  enableAudioRecording: false, // Audio recording kapalƒ±
  enableVideoRecording: false, // Video recording kapalƒ±
  enableHighPerformance: IS_PROD, // Production'da y√ºksek performans
  enableCloudProxy: false // Cloud proxy kapalƒ± - daha hƒ±zlƒ±
}

// Video kalite optimizasyonlarƒ±
export const VIDEO_CONFIG = {
  encoderConfig: IS_DEV ? '720p_1' : '1080p_1', // Development'ta daha d√º≈ü√ºk kalite
  bitrateMin: IS_DEV ? 1000 : 2000, // Development'ta daha d√º≈ü√ºk bitrate
  bitrateMax: IS_DEV ? 2000 : 4000, // Development'ta daha d√º≈ü√ºk bitrate
  frameRate: IS_DEV ? 24 : 30 // Development'ta daha d√º≈ü√ºk FPS
}
```

#### **Screen Share Optimizations**
```javascript
// ‚úÖ ƒ∞yi: Ekran payla≈üƒ±mƒ± i√ßin optimize edilmi≈ü ayarlar
export const SCREEN_SHARE_CONFIG = {
  FAST_START: {
    encoderConfig: '720p_1',      // 1280x720 √ß√∂z√ºn√ºrl√ºk - daha hƒ±zlƒ±
    optimizationMode: 'motion',   // Hareket i√ßin optimize
    bitrateMin: 800,              // Minimum bitrate
    bitrateMax: 1500,             // Maksimum bitrate
    frameRate: 15                 // 15 FPS - daha d√º≈ü√ºk, daha akƒ±cƒ±
  },
  
  LOW_QUALITY: {
    encoderConfig: '480p_1',      // 640x480 √ß√∂z√ºn√ºrl√ºk
    bitrateMin: 400,              // √áok d√º≈ü√ºk bitrate
    bitrateMax: 800,              // √áok d√º≈ü√ºk bitrate
    frameRate: 10                 // 10 FPS
  }
}
```

## üìä **Performance Monitoring**

### **1. Real-time Metrics**

#### **Network Quality Monitoring**
```javascript
// Aƒü kalitesi izleme
const monitorNetworkQuality = async (client) => {
  if (!client) return
  
  try {
    const stats = await client.getTransportStats()
    
    // RTT monitoring
    if (stats.Rtt > 200) {
      logWarn('High RTT detected', { rtt: stats.Rtt })
    }
    
    // Packet loss monitoring
    if (stats.PacketLossRate > 5) {
      logWarn('High packet loss detected', { loss: stats.PacketLossRate })
    }
    
    // Bitrate monitoring
    const audioStats = await client.getLocalAudioStats()
    const videoStats = await client.getLocalVideoStats()
    
    const totalBitrate = Object.values(audioStats).reduce((sum, stat) => 
      sum + (stat.sendBitrate || 0), 0
    ) + Object.values(videoStats).reduce((sum, stat) => 
      sum + (stat.sendBitrate || 0), 0
    )
    
    if (totalBitrate > 4000) {
      logWarn('High bitrate detected', { bitrate: totalBitrate })
    }
  } catch (error) {
    logError(error, { context: 'monitorNetworkQuality' })
  }
}
```

#### **Memory Usage Monitoring**
```javascript
// Memory kullanƒ±mƒ± izleme
const monitorMemoryUsage = () => {
  if ('memory' in performance) {
    const memoryInfo = performance.memory
    
    // Memory limit kontrol√º
    if (memoryInfo.usedJSHeapSize > memoryInfo.jsHeapSizeLimit * 0.8) {
      logWarn('High memory usage detected', {
        used: formatFileSize(memoryInfo.usedJSHeapSize),
        limit: formatFileSize(memoryInfo.jsHeapSizeLimit),
        percentage: Math.round((memoryInfo.usedJSHeapSize / memoryInfo.jsHeapSizeLimit) * 100)
      })
    }
    
    // Memory leak detection
    if (memoryInfo.usedJSHeapSize > previousMemoryUsage * 1.5) {
      logWarn('Potential memory leak detected', {
        previous: formatFileSize(previousMemoryUsage),
        current: formatFileSize(memoryInfo.usedJSHeapSize),
        increase: Math.round(((memoryInfo.usedJSHeapSize - previousMemoryUsage) / previousMemoryUsage) * 100)
      })
    }
    
    previousMemoryUsage = memoryInfo.usedJSHeapSize
  }
}
```

### **2. Performance Profiling**

#### **Custom Performance Marks**
```javascript
// Performance mark'larƒ± ekle
const addPerformanceMarks = () => {
  performance.mark('agora-conference-start')
  performance.mark('agora-client-init-start')
  performance.mark('agora-join-channel-start')
}

const measurePerformance = () => {
  performance.mark('agora-join-channel-end')
  performance.measure('join-channel-duration', 'agora-join-channel-start', 'agora-join-channel-end')
  
  const measure = performance.getEntriesByName('join-channel-duration')[0]
  logInfo('Join channel performance', { duration: measure.duration })
}
```

#### **Performance Observer**
```javascript
// Performance observer ile otomatik monitoring
const setupPerformanceObserver = () => {
  const observer = new PerformanceObserver((list) => {
    list.getEntries().forEach((entry) => {
      if (entry.entryType === 'measure') {
        logInfo('Performance measurement', {
          name: entry.name,
          duration: entry.duration,
          startTime: entry.startTime
        })
      }
    })
  })
  
  observer.observe({ entryTypes: ['measure'] })
}
```

## üîß **Performance Best Practices**

### **1. Component Optimization**

#### **Lazy Loading**
```javascript
// ‚úÖ ƒ∞yi: Conditional component loading
const LogModal = computed(() => {
  if (isLogOpen.value) {
    return () => import('./LogModal.vue')
  }
  return null
})

// Template'de
<component :is="LogModal" v-if="isLogOpen" />
```

#### **Virtual Scrolling**
```javascript
// ‚úÖ ƒ∞yi: B√ºy√ºk listeler i√ßin virtual scrolling
const virtualizedUsers = computed(() => {
  const startIndex = Math.floor(scrollTop.value / itemHeight)
  const endIndex = Math.min(startIndex + visibleItems, allUsers.value.length)
  
  return allUsers.value.slice(startIndex, endIndex)
})
```

### **2. State Management Optimization**

#### **Selective State Updates**
```javascript
// ‚úÖ ƒ∞yi: Sadece gerekli state'i g√ºncelle
const updateUserStatus = (uid, status) => {
  const userIndex = users.value.findIndex(u => u.uid === uid)
  if (userIndex > -1) {
    users.value[userIndex] = { ...users.value[userIndex], status }
  }
}

// ‚ùå K√∂t√º: T√ºm state'i g√ºncelle
const updateUserStatus = (uid, status) => {
  users.value = users.value.map(u => 
    u.uid === uid ? { ...u, status } : u
  )
}
```

#### **Batch Updates**
```javascript
// ‚úÖ ƒ∞yi: Batch updates ile performans
const batchUpdateUsers = (updates) => {
  nextTick(() => {
    updates.forEach(({ uid, updates }) => {
      updateUser(uid, updates)
    })
  })
}
```

### **3. Event Optimization**

#### **Event Deduplication**
```javascript
// ‚úÖ ƒ∞yi: Event deduplication ile gereksiz i≈ülemleri √∂nle
const processedEvents = ref(new Set())

const handleEvent = (eventType, data) => {
  const eventKey = createEventKey(eventType, data)
  
  if (processedEvents.value.has(eventKey)) {
    return false // Event zaten i≈ülendi
  }
  
  processedEvents.value.add(eventKey)
  
  // Event'i i≈üle
  processEvent(eventType, data)
  
  // 5 saniye sonra temizle
  setTimeout(() => {
    processedEvents.value.delete(eventKey)
  }, 5000)
}
```

#### **Debounced Updates**
```javascript
// ‚úÖ ƒ∞yi: UI updates i√ßin debouncing
const debouncedUpdateUI = debounce(() => {
  updateVideoGrid()
  updateControls()
}, 100)

// Event handler'da
const handleUserUpdate = () => {
  // State'i g√ºncelle
  updateUserState()
  
  // UI'ƒ± debounced olarak g√ºncelle
  debouncedUpdateUI()
}
```

## üìà **Performance Metrics**

### **1. Key Performance Indicators (KPIs)**

#### **Connection Performance**
- **Time to First Frame (TTFF)**: ƒ∞lk video frame'e kadar ge√ßen s√ºre
- **Join Channel Time**: Kanala katƒ±lma s√ºresi
- **Network Latency**: Aƒü gecikmesi (RTT)

#### **Stream Quality**
- **Bitrate Stability**: Bitrate kararlƒ±lƒ±ƒüƒ±
- **Frame Rate Consistency**: FPS tutarlƒ±lƒ±ƒüƒ±
- **Packet Loss Rate**: Paket kaybƒ± oranƒ±

#### **Resource Usage**
- **Memory Usage**: Bellek kullanƒ±mƒ±
- **CPU Usage**: CPU kullanƒ±mƒ±
- **Bandwidth Usage**: Bant geni≈üliƒüi kullanƒ±mƒ±

### **2. Performance Thresholds**

```javascript
// Performance threshold'larƒ±
export const PERFORMANCE_THRESHOLDS = {
  // Connection
  MAX_JOIN_TIME: 5000,        // 5 saniye
  MAX_RTT: 200,               // 200ms
  MAX_PACKET_LOSS: 5,         // %5
  
  // Quality
  MIN_BITRATE: 500,           // 500 kbps
  MIN_FRAME_RATE: 15,         // 15 FPS
  MAX_MEMORY_USAGE: 80,       // %80
  
  // Responsiveness
  MAX_UI_UPDATE_TIME: 100,    // 100ms
  MAX_EVENT_PROCESSING: 50    // 50ms
}
```

## üõ†Ô∏è **Performance Tools**

### **1. Development Tools**

#### **Vue DevTools Performance Tab**
```bash
# Vue DevTools extension'ƒ± y√ºkleyin
# Performance tab'ƒ±nda component render s√ºrelerini izleyin
```

#### **Chrome DevTools Performance**
```bash
# Performance tab'ƒ±nda recording yapƒ±n
# Flame chart ile CPU usage analizi
# Memory tab'ƒ±nda memory leak detection
```

### **2. Custom Performance Tools**

#### **Performance Logger**
```javascript
// Custom performance logger
class PerformanceLogger {
  constructor() {
    this.marks = new Map()
    this.measures = new Map()
  }
  
  mark(name) {
    performance.mark(name)
    this.marks.set(name, performance.now())
  }
  
  measure(name, startMark, endMark) {
    performance.measure(name, startMark, endMark)
    const measure = performance.getEntriesByName(name)[0]
    this.measures.set(name, measure.duration)
    
    return measure.duration
  }
  
  getMetrics() {
    return {
      marks: Object.fromEntries(this.marks),
      measures: Object.fromEntries(this.measures)
    }
  }
}

export const performanceLogger = new PerformanceLogger()
```

## üìä **Performance Monitoring Dashboard**

### **1. Real-time Metrics Display**

```vue
<template>
  <div class="performance-dashboard">
    <div class="metric-card">
      <h3>Network Quality</h3>
      <div class="metric-value">{{ networkQuality }}/6</div>
      <div class="metric-bar">
        <div class="bar-fill" :style="{ width: `${(networkQuality / 6) * 100}%` }"></div>
      </div>
    </div>
    
    <div class="metric-card">
      <h3>Bitrate</h3>
      <div class="metric-value">{{ bitrate }} kbps</div>
      <div class="metric-trend" :class="bitrateTrend">
        {{ bitrateChange }}%
      </div>
    </div>
    
    <div class="metric-card">
      <h3>Memory Usage</h3>
      <div class="metric-value">{{ memoryUsage }}%</div>
      <div class="metric-warning" v-if="memoryUsage > 80">
        ‚ö†Ô∏è High memory usage
      </div>
    </div>
  </div>
</template>
```

### **2. Performance Alerts**

```javascript
// Performance alert sistemi
const setupPerformanceAlerts = () => {
  // Network quality alerts
  watch(networkQuality, (quality) => {
    if (quality < 2) {
      showAlert('Low network quality detected', 'warning')
    }
  })
  
  // Memory usage alerts
  watch(memoryUsage, (usage) => {
    if (usage > 80) {
      showAlert('High memory usage detected', 'error')
    }
  })
  
  // Bitrate alerts
  watch(bitrate, (rate) => {
    if (rate < 500) {
      showAlert('Low bitrate detected', 'warning')
    }
  })
}
```

---

> **üí° ƒ∞pucu**: Bu performance dok√ºmantasyonu ile projenizin performansƒ±nƒ± optimize edebilir ve monitoring yapabilirsiniz.

